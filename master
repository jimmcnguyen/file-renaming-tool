import time
import os
from selenium.webdriver.chrome.options import Options
from selenium.webdriver import Chrome


# folder path
basedir = '//main-srvr01/Landing Page Accounts/AD-IQ'


# log in
opts = Options()
opts.set_headless()
assert opts.headless
browser = Chrome(options=opts)
browser.get('https://cocreate.ad.iq/customers?sort=&direction=&q=&firstdate=&lastdate=')
emailElem = browser.find_element_by_id('admin_email')
emailElem.send_keys('jimmyn@ad.iq')
passwordElem = browser.find_element_by_id('admin_password')
passwordElem.send_keys('Waterboy241!')
passwordElem.submit()
# logged in
time.sleep(1.0)
print('Logged into CRM')
# for every folder in the Ad.IQ landing page accounts...
try:
    for folder in os.listdir(basedir):
        if 'SMO' in folder and 'MUSE' in folder and 'Booster' in folder:
            continue
        # elif 'MUSE' in folder:
        #     continue
        # elif 'BOOSTER' in folder:
        #     continue
        elif '.BridgeLabelsAndRatings' in folder:
            continue
        elif '.BridgeSort' in folder:
            continue
        elif 'Cancel' in folder:
            continue
        else:
            print('Now searching for: ' + folder)
            # searches the domain on crm
            time.sleep(1.5)
            searchBar = browser.find_element_by_css_selector('#customer-filters-form > div > div.keywordsearchbox > input')
            searchBar.send_keys(folder)
            button = browser.find_element_by_css_selector(
                '#customer-filters-form > div > div.filtermasterwrapperbox > div > div.filter-btn_boxwrapper > div.applybtn_horizontalflex > button')
            button.click()
            time.sleep(1.5)
            # clicks 'Apply'
            customerContent = browser.find_element_by_css_selector('#customers-content > div.graph-masterwrapper > div.graph-headerbox > div > div')
            if customerContent.text == 'Customer Profiles (Not Found)':
                print(folder + ' not found')
            else:
                customerStatus = browser.find_element_by_css_selector(
                    '#customer-results > div > div:nth-child(3) > div > div > span')
                if 'Canceled' in customerStatus.text:
                    print(folder, customerStatus.text)
                    # find account number
                    # accountLink = browser.find_element_by_css_selector('#customer-results > div > div:nth-child(2) > div > a')
                    # accountLink.click()
                    # time.sleep(1.5)
                    # acc_numberElem = browser.find_element_by_css_selector('INSERT SELECTOR')
                    # acc_number = acc_numberElem.text[11:]
                    # newFolderName = acc_number + ' - Cancel'
                    # print('New folder name would be: ' + newFolderName)
                    os.rename(os.path.join(basedir, folder),
                              os.path.join(basedir, folder + ' - Cancel'))
                    print(folder + ' updated to ' + folder + ' - Cancel')
                else:
                    print(folder, customerStatus.text)
            searchBar.clear()
except:
    print('Error - skipped')
    pass
browser.quit()
