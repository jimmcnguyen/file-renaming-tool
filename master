import time
import os
from selenium.webdriver.chrome.options import Options
from selenium.webdriver import Chrome


# folder path
basedir = '//main-srvr01/Landing Page Accounts/AD-IQ'


# for every folder in the Ad.IQ landing page accounts...

try:
    for folder in os.listdir(basedir):
        if 'SMO' in folder:
            continue
        elif 'MUSE' in folder:
            continue
        elif '.BridgeLabelsAndRatings' in folder:
            continue
        elif '.BridgeSort' in folder:
            continue
        # else:
        elif folder == 'Jimmy Beans LLC':
            print(folder)
            # logs into CRM
            opts = Options()
            opts.set_headless()
            assert opts.headless
            browser = Chrome(options=opts)
            browser.get('https://cocreate.ad.iq/customers?sort=&direction=&q=&firstdate=&lastdate=')
            emailElem = browser.find_element_by_id('admin_email')
            emailElem.send_keys('jimmyn@ad.iq')
            passwordElem = browser.find_element_by_id('admin_password')
            passwordElem.send_keys('Waterboy241!')
            passwordElem.submit()
            # logged in
            time.sleep(1.0)
            # searches the domain on crm
            searchBar = browser.find_element_by_css_selector('#customer-filters-form > div > div.keywordsearchbox > input')
            searchBar.send_keys(folder)
            button = browser.find_element_by_css_selector(
                '#customer-filters-form > div > div.filtermasterwrapperbox > div > div.filter-btn_boxwrapper > div.applybtn_horizontalflex > button')
            button.click()
            time.sleep(1.5)
            # clicks 'Apply'
            customerContent = browser.find_element_by_css_selector('#customers-content > div.graph-masterwrapper > div.graph-headerbox > div > div')
            if customerContent.text == 'Customer Profiles (Not Found)':
                print(folder + ' not found')
            else:
                customerStatus = browser.find_element_by_css_selector(
                    '#customer-results > div > div:nth-child(3) > div > div > span')
                if 'Canceled' in customerStatus.text:
                    print(folder, customerStatus.text)
                else:
                    print(folder, customerStatus.text)
    browser.quit()
except:
    print('Error')
